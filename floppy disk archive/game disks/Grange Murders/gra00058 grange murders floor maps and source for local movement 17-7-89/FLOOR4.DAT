mSeed)=c0
 &LongWS(HiLongRandomSeed)=c0

 MarginZ=0
 SizeZ=0
 MarginX=0
 SizeX=0
 BackType=BTnormal
 MapOn=0
 ViewOn=1
 BulkMode=0

 RoomNum=0
 CursorZ=64
 CursorX=0
 CursorH=64
 AnimationACB=0
 CurrentCache=0
 Flash=0

cif Animation
 ObjectNumber=2501
 AnimationNumber=ObjectNumber
 dv2=DefaultX
 dv3=DefaultZ
 dv4=CursorH
 gosub @StartFreeACB
 AnimationACB=dx4
cend ;Animation

cif CacheOn
 MapNumber=0
 v1=200 ;table size (50 rooms)
 gosub @FCinitFloorCache
 gosub @FCloadFloor
cend

cif CacheOff
 MapNumber=49 ;'1'
 &FloorMap(c0)=c0 ;if no map, clear memory
 gosub @LoadMap
 gosub @FindRoom
cend

.DangerousRestart
 RasterOffset=0

 dv1=100
 gosub @PreLoad100

cif Animation
 dv1=500
 dv2=1100
.xPLLoop2
 push dv2 ;count
 dv2=16 ; x
 dv3=92 ; z
 dv4=64 ; h
 dv5=dMarkPreload
 dv6=0 ; non-reflected
 gosub @MCDrawObjectdV1
 add dv1,c1
 pop dv2 ;count
 sub dv2,c1
 if dv2>0 then xPLLoop2

 gosub @MCPreLoadCells
cend ;Animation

 gosub @MCEmptyRoom

 dv1=RoomNum
 gosub @PreLoadAndInsertdv1 ; DrawObjectdv1

 gosub @MCBuildRoom

 CursorSprite=1

.MainLoop
 gosub @ScanKeyboard
 gosub @ScanJoystick
 gosub @ExecuteCommand
 if KeyCode<>0 then MainLoop
 gosub @DisplayEverything
 goto MainLoop

;-----

.ScanKeyboard
 